name: Integration Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  browser-detection:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4

      - uses: oven-sh/setup-bun@v2

      - uses: actions/setup-node@v4
        with:
          node-version: 22

      - run: bun install --frozen-lockfile

      - name: List detected browsers
        shell: bash
        run: |
          echo "--- Checking known browser paths ---"
          for bin in \
            /usr/bin/google-chrome \
            /usr/bin/microsoft-edge \
            /usr/bin/chromium \
            /usr/bin/chromium-browser \
            "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome" \
            "/Applications/Microsoft Edge.app/Contents/MacOS/Microsoft Edge" \
            "/Applications/Safari.app/Contents/MacOS/Safari" \
            "C:\Program Files\Google\Chrome\Application\chrome.exe" \
            "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe"; do
            if [ -f "$bin" ]; then
              echo "FOUND: $bin"
            fi
          done

      - run: bun run integration-test.ts
